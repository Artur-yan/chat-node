generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  // production
  // url      = "postgresql://postgres:H4idB56bOlpQLOAV@db.guhkoqzapksvcdqqfznk.supabase.co:5432/postgres"
}

model AuthUser {
  id                String         @id @unique
  email             String         @unique
  status            String?
  verification_uuid String?        @unique
  new_email         String?        @unique
  created           DateTime       @default(now())
  auth_key          AuthKey?
  auth_session      AuthSession[]
  bots              Bots[]
  subscription      Subscriptions?

  @@map("auth_user")
}

model AuthSession {
  id             String   @id @unique
  user_id        String
  active_expires BigInt
  idle_expires   BigInt
  auth_user      AuthUser @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@map("auth_session")
}

model AuthKey {
  id              String   @id @unique
  hashed_password String?
  user_id         String   @unique
  primary_key     Boolean
  expires         BigInt?
  auth_user       AuthUser @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@map("auth_key")
}

model Bots {
  id               String   @id @unique
  created          DateTime @default(now())
  data_source_type String?
  user_id          String
  name             String?
  settings         Json?
  status           String   @default("training")
  tocken_count     Int      @default(0)
  slack_bot_status Boolean? @default(false)
  auth_user        AuthUser @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("bots")
}

model Subscriptions {
  user_id             String    @id
  max_bot             Int?      @default(1) @db.SmallInt
  max_msg             Int?      @default(30)
  plan                Int?      @default(0) @db.SmallInt
  last_reset_date     DateTime? @default(dbgenerated("(now() AT TIME ZONE 'utc'::text)")) @db.Timestamptz(6)
  stripe_customer_id  String?
  bot_count           Int       @default(0) @db.SmallInt
  msg_count           Int       @default(0)
  stripe_subscription String?   @unique
  status              String?
  max_tocken          Int       @default(100000)
  auth_user           AuthUser  @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("subscriptions")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model chat_history {
  session_id   String  @id(map: "conversation_pkey")
  namespace    String?
  chat_history Json[]
}

/// The underlying table does not contain a valid unique identifier and can therefore currently not be handled by the Prisma Client.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model BotsSource {
  s3_key      String @unique
  name        String?
  source_type String?
  id          String?

  @@map("bots_source")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model slack_bots {
  id                    Int       @id @default(autoincrement())
  client_id             String    @db.VarChar(32)
  app_id                String    @db.VarChar(32)
  enterprise_id         String?   @db.VarChar(32)
  enterprise_name       String?   @db.VarChar(200)
  team_id               String?   @db.VarChar(32)
  team_name             String?   @db.VarChar(200)
  bot_token             String?   @db.VarChar(200)
  bot_id                String?   @db.VarChar(32)
  bot_user_id           String?   @db.VarChar(32)
  bot_scopes            String?   @db.VarChar(1000)
  bot_refresh_token     String?   @db.VarChar(200)
  bot_token_expires_at  DateTime? @db.Timestamp(6)
  is_enterprise_install Boolean
  installed_at          DateTime  @db.Timestamp(6)
  bot_internal_id       String?

  @@index([client_id, enterprise_id, team_id, installed_at], map: "slack_bots_idx")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model slack_installations {
  id                                 Int       @id @default(autoincrement())
  client_id                          String    @db.VarChar(32)
  app_id                             String    @db.VarChar(32)
  enterprise_id                      String?   @db.VarChar(32)
  enterprise_name                    String?   @db.VarChar(200)
  enterprise_url                     String?   @db.VarChar(200)
  team_id                            String?   @db.VarChar(32)
  team_name                          String?   @db.VarChar(200)
  bot_token                          String?   @db.VarChar(200)
  bot_id                             String?   @db.VarChar(32)
  bot_user_id                        String?   @db.VarChar(32)
  bot_scopes                         String?   @db.VarChar(1000)
  bot_refresh_token                  String?   @db.VarChar(200)
  bot_token_expires_at               DateTime? @db.Timestamp(6)
  user_id                            String    @db.VarChar(32)
  user_token                         String?   @db.VarChar(200)
  user_scopes                        String?   @db.VarChar(1000)
  user_refresh_token                 String?   @db.VarChar(200)
  user_token_expires_at              DateTime? @db.Timestamp(6)
  incoming_webhook_url               String?   @db.VarChar(200)
  incoming_webhook_channel           String?   @db.VarChar(200)
  incoming_webhook_channel_id        String?   @db.VarChar(200)
  incoming_webhook_configuration_url String?   @db.VarChar(200)
  is_enterprise_install              Boolean
  token_type                         String?   @db.VarChar(32)
  installed_at                       DateTime  @db.Timestamp(6)
  bot_internal_id                    String?

  @@index([client_id, enterprise_id, team_id, user_id, installed_at], map: "slack_installations_idx")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model slack_oauth_states {
  id        Int      @id @default(autoincrement())
  state     String   @db.VarChar(200)
  expire_at DateTime @db.Timestamp(6)
}
